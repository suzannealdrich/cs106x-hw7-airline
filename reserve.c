/* * File:   reserve.c * Author: Suzanne Aldrich * -------------- * This file implements the reservation abstraction. */#include <stdio.h>#include <ctype.h>#include "genlib.h"#include "strlib.h"#include "squeue.h"#include "symtab.h"#include "numGen.h"#include "reserve.h"resRec **InitSeats(flight *plane);int CountEmptySeats(flight *plane, int row, int seat);void FillSeats(flight *plane, resRec *party);void EmptySeats(flight *plane, resRec *party);int PriorityFunc(void *elem1, void *elem2);bool MatchFunc(void *elem, void *compareValue);bool FitFunc(void *elem, void *compareValue);static string priorities[3] = { "standard", "emergency", "premier" };/* Public Functions */flight *InitPlane(void){	flight *plane = (flight *) GetBlock(sizeof(flight));	 	plane->numRows = N_ROWS;	plane->numSeats = N_SEATS;	plane->seatsLeft = N_ROWS * N_SEATS;	plane->planeSeats = InitSeats(plane);	plane->nameTable = NewSymbolTable();	plane->standbyQueue = NewSpecialQueue(PriorityFunc);		return plane;}resRec *InitParty(void){	resRec *party = GetBlock(sizeof(resRec));		party->id = GenerateConfirmationNumber();	party->partySize = 0;	party->nameList = NULL;	party->priority = standard;	party->seatingStatus = processing;	party->row = 0;	party->seat = 0;	return party;}bool SeatParty(resRec *party, flight *plane){	int i, j;		if (party->partySize <= plane->seatsLeft) {		for (i = 0; i < plane->numRows; i++) {			for (j = 0; j < plane->numSeats; j++) {				if (CountEmptySeats(plane, i, j) >= party->partySize) {					party->row = i;					party->seat = j;					party->seatingStatus = seated;					FillSeats(plane, party);					return TRUE;				}			}		}	}	party->seatingStatus = standby;	Insert(plane->standbyQueue, party);	return FALSE;}void SeatStandbys(flight *plane, int row, printFnT print){	int seat, count;	resRec *party;		for (seat = 0; seat < plane->numSeats; seat++) {		count = CountEmptySeats(plane, row, seat);		if (count > 0) {			party = Extract(plane->standbyQueue, FitFunc, &count);			if (party) {				party->row = row;				party->seat = seat;				party->seatingStatus = seated;				FillSeats(plane, party);				if (print) (*print)(plane, party);				seat += party->partySize - 1;			}		}	}}void RemoveSeated(flight *plane, resRec *party){	EmptySeats(plane, party);}void RemoveStandby(flight *plane, resRec *party){	Extract(plane->standbyQueue, MatchFunc, party);}string PriorityToStr(vipT priority){	return (priorities[priority - standard]);}vipT StrToPriority(string priority){	vipT p;		priority = ConvertToLowerCase(priority);	for (p = standard; p <= premier; p++) {		if (StringEqual(priority, priorities[p - standard])) return p;	}	return standard;}/* Private Functions */static resRec **InitSeats(flight *plane){	int i, j;	resRec **seats = GetBlock(plane->numRows * plane->numSeats * sizeof(resRec *));	resRec **seat = seats;		for (i = 0; i < plane->numRows; i++) {		for (j = 0; j < plane->numSeats; j++) {			*seat++ = NULL;		}	}	return seats;}static int PriorityFunc(void *elem1, void *elem2){		resRec *r1, *r2;		r1 = (resRec *) elem1;	r2 = (resRec *) elem2;	return (r1->priority  > r2->priority) ? 1 : (r1->priority  < r2->priority) ? -1 : 0;}static bool MatchFunc(void *elem, void *compareValue){	return (elem == compareValue);}static bool FitFunc(void *elem, void *compareValue){	resRec *party = (resRec *) elem;	int seats = *(int *) compareValue;		return (party->partySize <= seats);}static int CountEmptySeats(flight *plane, int row, int seat){	int count = 0, index = row * plane->numSeats + seat;		while (plane->planeSeats[index++] == NULL && seat++ < plane->numSeats) {		count++;	}	return count;}static void FillSeats(flight *plane, resRec *party){	int index = party->row * plane->numSeats + party->seat;	int n = party->partySize;	while (n--) {		plane->planeSeats[index++] = party;		plane->seatsLeft--;	}}static void EmptySeats(flight *plane, resRec *party){	int index = party->row * plane->numSeats + party->seat;	int n = party->partySize;	while (n--) {		plane->planeSeats[index++] = NULL;		plane->seatsLeft++;	}}